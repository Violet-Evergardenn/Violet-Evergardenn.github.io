<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>week 4 | 苦难的大地</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.ttf");
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"复制"}}</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>:root {
 --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
 --light-background: url('/img/bk.jpg');
 --theme-encrypt-confirm: '确认'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@10.5.0/dist/mermaid.esm.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.busuanzi'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/myself"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>week 4</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2024-01-17T15:02:00.000Z" id="date"> 2024-01-17</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2024-01-17T15:11:46.666Z" id="updated"> 2024-01-17</time></div></span></div></div><hr><div id="post-content"><h1 id="Volume-将wav文件修改音量大小"><a href="#Volume-将wav文件修改音量大小" class="headerlink" title="Volume(将wav文件修改音量大小)"></a>Volume(将wav文件修改音量大小)</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Modifies the volume of an audio file</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-comment">// Number of bytes in .wav header</span><br><span class="hljs-comment">//.wav格式的头就是44个uint8_t组成的</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> HEADER_SIZE = <span class="hljs-number">44</span>;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-comment">// Check command-line arguments</span><br>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">4</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: ./volume input.wav output.wav factor\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Open files and determine scaling factor</span><br>    FILE *input = fopen(argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span> (input == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Could not open file.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    FILE *output = fopen(argv[<span class="hljs-number">2</span>], <span class="hljs-string">&quot;w&quot;</span>);<br>    <span class="hljs-keyword">if</span> (output == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Could not open file.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-type">float</span> factor = atof(argv[<span class="hljs-number">3</span>]);<br><br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Copy header from input file to output file</span><br>    <span class="hljs-type">uint8_t</span> header[HEADER_SIZE];<br>    fread(header, HEADER_SIZE, <span class="hljs-number">1</span>, input);<br>    <span class="hljs-comment">//默认是uint8_t所以直接写44就是默认为44个uint8_t，也可以写成sizeof(header)</span><br>    fwrite(header, HEADER_SIZE, <span class="hljs-number">1</span>, output);<br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Read samples from input file and write updated data to output file</span><br><br><br>	<span class="hljs-comment">//使用int16_t表示2个字节和有符号</span><br>    <span class="hljs-type">int16_t</span> buffer;<br><br>    <span class="hljs-keyword">while</span>(fread(&amp;buffer,<span class="hljs-keyword">sizeof</span>(buffer),<span class="hljs-number">1</span>,input))<br>    &#123;<br>	    <span class="hljs-comment">//修改音量大小</span><br>        buffer =(<span class="hljs-type">int16_t</span>)(buffer*factor);<br>        fwrite(&amp;buffer,<span class="hljs-keyword">sizeof</span>(buffer),<span class="hljs-number">1</span>,output);<br>    &#125;<br><br>    <span class="hljs-comment">// Close files</span><br>    fclose(input);<br>    fclose(output);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h1 id="Filter-more-对bmp的图像进行变灰，翻转，模糊，边缘处理"><a href="#Filter-more-对bmp的图像进行变灰，翻转，模糊，边缘处理" class="headerlink" title="Filter more(对bmp的图像进行变灰，翻转，模糊，边缘处理)"></a>Filter more(对bmp的图像进行变灰，翻转，模糊，边缘处理)</h1><h2 id="bmp-h-包含处理bmp图像的数据结构"><a href="#bmp-h-包含处理bmp图像的数据结构" class="headerlink" title="bmp.h(包含处理bmp图像的数据结构)"></a>bmp.h(包含处理bmp图像的数据结构)</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/nyist_yangguang/article/details/122316614">【笔记】位图（.bmp）和矢量图（Vector)</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// BMP-related data types based on Microsoft&#x27;s own</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Common Data Types</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * The data types in this section are essentially aliases for C/C++</span><br><span class="hljs-comment"> * primitive data types.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Adapted from http://msdn.microsoft.com/en-us/library/cc230309.aspx.</span><br><span class="hljs-comment"> * See http://en.wikipedia.org/wiki/Stdint.h for more on stdint.h.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">uint8_t</span>  BYTE;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">uint32_t</span> DWORD;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">int32_t</span>  LONG;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">uint16_t</span> WORD;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * BITMAPFILEHEADER</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * The BITMAPFILEHEADER structure contains information about the type, size,</span><br><span class="hljs-comment"> * and layout of a file that contains a DIB [device-independent bitmap].</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Adapted from http://msdn.microsoft.com/en-us/library/dd183374(VS.85).aspx.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><span class="hljs-comment">//位图文件头</span><br>    WORD   bfType;<br>    DWORD  bfSize;<br>    WORD   bfReserved1;<br>    WORD   bfReserved2;<br>    DWORD  bfOffBits;<br>&#125; __attribute__((__packed__))<br>BITMAPFILEHEADER;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * BITMAPINFOHEADER</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * The BITMAPINFOHEADER structure contains information about the</span><br><span class="hljs-comment"> * dimensions and color format of a DIB [device-independent bitmap].</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Adapted from http://msdn.microsoft.com/en-us/library/dd183376(VS.85).aspx.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><span class="hljs-comment">//位图信息头</span><br>    DWORD  biSize;<br>    LONG   biWidth;<br>    LONG   biHeight;<br>    WORD   biPlanes;<br>    WORD   biBitCount;<span class="hljs-comment">//每个像素的位数1-黑白图，4-16色，8-256色，24-真彩色</span><br>    DWORD  biCompression;<br>    DWORD  biSizeImage;<br>    LONG   biXPelsPerMeter;<br>    LONG   biYPelsPerMeter;<br>    DWORD  biClrUsed;<br>    DWORD  biClrImportant;<br>&#125; __attribute__((__packed__))<br>BITMAPINFOHEADER;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * RGBTRIPLE</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * This structure describes a color consisting of relative intensities of</span><br><span class="hljs-comment"> * red, green, and blue.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Adapted from http://msdn.microsoft.com/en-us/library/aa922590.aspx.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>    BYTE  rgbtBlue;<br>    BYTE  rgbtGreen;<br>    BYTE  rgbtRed;<br>&#125; __attribute__((__packed__))<br>RGBTRIPLE;<br><br></code></pre></td></tr></table></figure>

<h2 id="help-h-形成头文件，并把bmp-h也带进help-c中"><a href="#help-h-形成头文件，并把bmp-h也带进help-c中" class="headerlink" title="help.h(形成头文件，并把bmp.h也带进help.c中)"></a>help.h(形成头文件，并把bmp.h也带进help.c中)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;bmp.h&quot;</span></span><br><br><span class="hljs-comment">// Convert image to grayscale</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">grayscale</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span>;<br><br><span class="hljs-comment">// Reflect image horizontally</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">reflect</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span>;<br><br><span class="hljs-comment">// Detect edges</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">edges</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span>;<br><br><span class="hljs-comment">// Blur image</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">blur</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span>;<br><br></code></pre></td></tr></table></figure>

<h2 id="help-c-实现变灰，翻转，模糊，边缘功能"><a href="#help-c-实现变灰，翻转，模糊，边缘功能" class="headerlink" title="help.c(实现变灰，翻转，模糊，边缘功能)"></a>help.c(实现变灰，翻转，模糊，边缘功能)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;helpers.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;math.h&gt;</span></span><br><br><span class="hljs-comment">// 将图像转换为灰度图</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">grayscale</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; width; j++)<br>        &#123;<br>            RGBTRIPLE pixel = image[i][j];<br>            <span class="hljs-comment">// 计算平均值</span><br>            BYTE avg = round((pixel.rgbtRed + pixel.rgbtGreen + pixel.rgbtBlue) / <span class="hljs-number">3.0</span>);<br>            <span class="hljs-comment">//使用 round 函数对平均值进行四舍五入，</span><br>            <span class="hljs-comment">// 设置灰度值</span><br>            image[i][j].rgbtRed = image[i][j].rgbtGreen = image[i][j].rgbtBlue = avg;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 将图像水平反射</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">reflect</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; width / <span class="hljs-number">2</span>; j++)<br>        &#123;<br>            <span class="hljs-comment">// 交换像素</span><br>            RGBTRIPLE temp = image[i][j];<br>            image[i][j] = image[i][width - <span class="hljs-number">1</span> - j];<br>            image[i][width - <span class="hljs-number">1</span> - j] = temp;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 对图像进行模糊处理</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">blur</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span><br>&#123;<br>    RGBTRIPLE temp[height][width];<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; width; j++)<br>        &#123;<br>            <span class="hljs-type">int</span> sumRed = <span class="hljs-number">0</span>, sumGreen = <span class="hljs-number">0</span>, sumBlue = <span class="hljs-number">0</span>;<br>            <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;<br><br>            <span class="hljs-comment">// 计算像素周围的颜色平均值</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> di = <span class="hljs-number">-1</span>; di &lt;= <span class="hljs-number">1</span>; di++)<br>            &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> dj = <span class="hljs-number">-1</span>; dj &lt;= <span class="hljs-number">1</span>; dj++)<br>                &#123;<br>                    <span class="hljs-type">int</span> newI = i + di;<br>                    <span class="hljs-type">int</span> newJ = j + dj;<br><br>                    <span class="hljs-comment">// 检查边界</span><br>                    <span class="hljs-keyword">if</span> (newI &gt;= <span class="hljs-number">0</span> &amp;&amp; newI &lt; height &amp;&amp; newJ &gt;= <span class="hljs-number">0</span> &amp;&amp; newJ &lt; width)<br>                    &#123;<br>                        RGBTRIPLE pixel = image[newI][newJ];<br>                        sumRed += pixel.rgbtRed;<br>                        sumGreen += pixel.rgbtGreen;<br>                        sumBlue += pixel.rgbtBlue;<br>                        count++;<br>                    &#125;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// 设置模糊后的颜色值</span><br>            temp[i][j].rgbtRed = round(sumRed / (<span class="hljs-type">float</span>) count);<br>            temp[i][j].rgbtGreen = round(sumGreen / (<span class="hljs-type">float</span>) count);<br>            temp[i][j].rgbtBlue = round(sumBlue / (<span class="hljs-type">float</span>) count);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 将计算的结果复制回原图像</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; width; j++)<br>        &#123;<br>            image[i][j] = temp[i][j];<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 边缘检测</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">edges</span><span class="hljs-params">(<span class="hljs-type">int</span> height, <span class="hljs-type">int</span> width, RGBTRIPLE image[height][width])</span><br>&#123;<br>    <span class="hljs-comment">// 创建一个临时图像来存储新的像素值</span><br>    RGBTRIPLE temp[height][width];<br><br>    <span class="hljs-comment">// Sobel算子</span><br>    <span class="hljs-type">int</span> Gx[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>] = &#123;&#123;<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;, &#123;<span class="hljs-number">-2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>&#125;, &#123;<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;&#125;;<br>    <span class="hljs-type">int</span> Gy[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>] = &#123;&#123;<span class="hljs-number">-1</span>, <span class="hljs-number">-2</span>, <span class="hljs-number">-1</span>&#125;, &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;, &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>&#125;&#125;;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; width; j++)<br>        &#123;<br>            <span class="hljs-type">float</span> sumRedX = <span class="hljs-number">0</span>, sumGreenX = <span class="hljs-number">0</span>, sumBlueX = <span class="hljs-number">0</span>;<br>            <span class="hljs-type">float</span> sumRedY = <span class="hljs-number">0</span>, sumGreenY = <span class="hljs-number">0</span>, sumBlueY = <span class="hljs-number">0</span>;<br><br>            <span class="hljs-comment">// 应用Sobel算子</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> di = <span class="hljs-number">-1</span>; di &lt;= <span class="hljs-number">1</span>; di++)<br>            &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> dj = <span class="hljs-number">-1</span>; dj &lt;= <span class="hljs-number">1</span>; dj++)<br>                &#123;<br>                    <span class="hljs-keyword">if</span> (i + di &lt; <span class="hljs-number">0</span> || i + di &gt;= height || j + dj &lt; <span class="hljs-number">0</span> || j + dj &gt;= width)<br>                    &#123;<br>                        <span class="hljs-keyword">continue</span>;<br>                    &#125;<br><br>                    RGBTRIPLE pixel = image[i + di][j + dj];<br><br>                    sumRedX += pixel.rgbtRed * Gx[di + <span class="hljs-number">1</span>][dj + <span class="hljs-number">1</span>];<br>                    sumGreenX += pixel.rgbtGreen * Gx[di + <span class="hljs-number">1</span>][dj + <span class="hljs-number">1</span>];<br>                    sumBlueX += pixel.rgbtBlue * Gx[di + <span class="hljs-number">1</span>][dj + <span class="hljs-number">1</span>];<br><br>                    sumRedY += pixel.rgbtRed * Gy[di + <span class="hljs-number">1</span>][dj + <span class="hljs-number">1</span>];<br>                    sumGreenY += pixel.rgbtGreen * Gy[di + <span class="hljs-number">1</span>][dj + <span class="hljs-number">1</span>];<br>                    sumBlueY += pixel.rgbtBlue * Gy[di + <span class="hljs-number">1</span>][dj + <span class="hljs-number">1</span>];<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// 计算新的RGB值</span><br>            <span class="hljs-type">int</span> red = round(<span class="hljs-built_in">sqrt</span>(sumRedX * sumRedX + sumRedY * sumRedY));<br>            <span class="hljs-type">int</span> green = round(<span class="hljs-built_in">sqrt</span>(sumGreenX * sumGreenX + sumGreenY * sumGreenY));<br>            <span class="hljs-type">int</span> blue = round(<span class="hljs-built_in">sqrt</span>(sumBlueX * sumBlueX + sumBlueY * sumBlueY));<br><br>            <span class="hljs-comment">// 确保像素值在0-255的范围内</span><br>            temp[i][j].rgbtRed = (red &gt; <span class="hljs-number">255</span>) ? <span class="hljs-number">255</span> : red;<br>            temp[i][j].rgbtGreen = (green &gt; <span class="hljs-number">255</span>) ? <span class="hljs-number">255</span> : green;<br>            temp[i][j].rgbtBlue = (blue &gt; <span class="hljs-number">255</span>) ? <span class="hljs-number">255</span> : blue;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 将计算出的新像素值复制回原图像</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; width; j++)<br>        &#123;<br>            image[i][j] = temp[i][j];<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="filter-c-集合所有，实现目标"><a href="#filter-c-集合所有，实现目标" class="headerlink" title="filter.c(集合所有，实现目标)"></a>filter.c(集合所有，实现目标)</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;getopt.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;helpers.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-comment">// Define allowable filters</span><br>    <span class="hljs-type">char</span> *filters = <span class="hljs-string">&quot;begr&quot;</span>;<br><br>    <span class="hljs-comment">// Get filter flag and check validity</span><br>    <span class="hljs-comment">//要使用getopt要在执行程序时使用 &#x27;-&#x27;,否则getopt无法识别到</span><br>    <span class="hljs-type">char</span> filter = getopt(argc, argv, filters);<span class="hljs-comment">//getopt函数也是用地址的</span><br>    <span class="hljs-comment">//代码首先定义了一个字符串filters，包含了允许的过滤器字符。然后，使用getopt函数来获取命令行参数中的过滤器选项。如果获取getopt返回的是-1，filter就会被赋值为&#x27;?&#x27;，表示没找到许的过滤器字符</span><br>    <span class="hljs-keyword">if</span> (filter == <span class="hljs-string">&#x27;?&#x27;</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Invalid filter.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Ensure only one filter</span><br>    <span class="hljs-comment">//接下来，代码再次调用getopt函数，以确保只允许使用一个过滤器。如果再次调用getopt函数后返回的值不是-1，说明已经使用了多个过滤器，</span><br>    <span class="hljs-comment">//getopt函数是会自己移动的，它会从剩余的命令行参数中继续查找，直到找到下一个有效的过滤器选项或者没有更多的参数为止。</span><br>    <span class="hljs-keyword">if</span> (getopt(argc, argv, filters) != <span class="hljs-number">-1</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Only one filter allowed.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Ensure proper usage</span><br>    <span class="hljs-keyword">if</span> (argc != optind + <span class="hljs-number">2</span>)<br>    &#123;<span class="hljs-comment">//这个判断是在检查命令行参数的数量是否正确。如果不正确，程序会打印使用方法并返回错误代码3。</span><br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: ./filter [flag] infile outfile\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Remember filenames</span><br>    <span class="hljs-type">char</span> *infile = argv[optind];<br>    <span class="hljs-comment">//optind 是一个全局变量，它在 &lt;unistd.h&gt; 头文件中定义。这个变量用于记录命令行参数的解析进度，通常与 getopt 函数一起使用。</span><br><span class="hljs-comment">//</span><br>    <span class="hljs-comment">//因为数组是从0开始计算的，但是argc和optind都是从1开始计算的</span><br>    <span class="hljs-comment">//所以是argv[optind]</span><br>    <span class="hljs-type">char</span> *outfile = argv[optind + <span class="hljs-number">1</span>];<br><br>    <span class="hljs-comment">// Open input file</span><br>    FILE *inptr = fopen(infile, <span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span> (inptr == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Could not open %s.\n&quot;</span>, infile);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Open output file</span><br>    FILE *outptr = fopen(outfile, <span class="hljs-string">&quot;w&quot;</span>);<br>    <span class="hljs-keyword">if</span> (outptr == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        fclose(inptr);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Could not create %s.\n&quot;</span>, outfile);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Read infile&#x27;s BITMAPFILEHEADER</span><br>    BITMAPFILEHEADER bf;<br>    fread(&amp;bf, <span class="hljs-keyword">sizeof</span>(BITMAPFILEHEADER), <span class="hljs-number">1</span>, inptr);<br><br>    <span class="hljs-comment">// Read infile&#x27;s BITMAPINFOHEADER</span><br>    BITMAPINFOHEADER bi;<br>    fread(&amp;bi, <span class="hljs-keyword">sizeof</span>(BITMAPINFOHEADER), <span class="hljs-number">1</span>, inptr);<br><br>    <span class="hljs-comment">// Ensure infile is (likely) a 24-bit uncompressed BMP 4.0</span><br>    <span class="hljs-keyword">if</span> (bf.bfType != <span class="hljs-number">0x4d42</span> || bf.bfOffBits != <span class="hljs-number">54</span> || bi.biSize != <span class="hljs-number">40</span> ||<br>        bi.biBitCount != <span class="hljs-number">24</span> || bi.biCompression != <span class="hljs-number">0</span>)<br>    &#123;<br>        fclose(outptr);<br>        fclose(inptr);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Unsupported file format.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">6</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Get image&#x27;s dimensions</span><br>    <span class="hljs-type">int</span> height = <span class="hljs-built_in">abs</span>(bi.biHeight);<br>    <span class="hljs-type">int</span> width = bi.biWidth;<br><br>    <span class="hljs-comment">// Allocate memory for image</span><br>    RGBTRIPLE(*image)[width] = <span class="hljs-built_in">calloc</span>(height, width * <span class="hljs-keyword">sizeof</span>(RGBTRIPLE));<br>    <span class="hljs-comment">//(*image)[width] 这段代码的意思是声明一个指向 RGBTRIPLE 类型的指针数组，其中每个指针指向一个包含 width </span><br>    <span class="hljs-comment">//个 RGBTRIPLE 元素的数组。这样就可以创建一个包含 height 行、width 列的二维数组结构。</span><br>    <span class="hljs-comment">//这行代码做了以下几件事情：</span><br>    <span class="hljs-comment">//使用 calloc 函数动态分配了一个二维数组，数组的行数是 height，列数是 width。</span><br>    <span class="hljs-comment">//为了声明这个二维数组，使用了指向 RGBTRIPLE 结构体的指针，这个指针指向一个长度为 width 的一维数组。</span><br>    <span class="hljs-comment">//将分配的内存赋值给 image，这样 image 就指向了一个二维数组，可以用来存储图像的像素信息。</span><br>    <span class="hljs-keyword">if</span> (image == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Not enough memory to store image.\n&quot;</span>);<br>        fclose(outptr);<br>        fclose(inptr);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">7</span>;<br>    &#125;<br>    <span class="hljs-comment">//这段代码是用来从输入文件中读取图像的像素数据，并跳过每行的填充字节。</span><br>    <span class="hljs-comment">//在BMP格式的图像文件中，每行像素数据存储后会进行填充，使得每行的字节数是4的倍数。</span><br>    <span class="hljs-comment">//start</span><br><br>    <span class="hljs-comment">// Determine padding for scanlines</span><br>    <span class="hljs-type">int</span> padding = (<span class="hljs-number">4</span> - (width * <span class="hljs-keyword">sizeof</span>(RGBTRIPLE)) % <span class="hljs-number">4</span>) % <span class="hljs-number">4</span>;<br><br>    <span class="hljs-comment">// Iterate over infile&#x27;s scanlines</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-comment">// Read row into pixel array</span><br>        fread(image[i], <span class="hljs-keyword">sizeof</span>(RGBTRIPLE), width, inptr);<br><br>        <span class="hljs-comment">// Skip over padding</span><br>        fseek(inptr, padding, SEEK_CUR);<br>    &#125;<br>    <span class="hljs-comment">//over</span><br><br>    <span class="hljs-comment">// Filter image</span><br>    <span class="hljs-keyword">switch</span> (filter)<br>    &#123;<br>        <span class="hljs-comment">// Blur</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;b&#x27;</span>:<br>            blur(height, width, image);<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-comment">// Edges</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;e&#x27;</span>:<br>            edges(height, width, image);<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-comment">// Grayscale</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;g&#x27;</span>:<br>            grayscale(height, width, image);<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-comment">// Reflect</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;r&#x27;</span>:<br>            reflect(height, width, image);<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Write outfile&#x27;s BITMAPFILEHEADER</span><br>    fwrite(&amp;bf, <span class="hljs-keyword">sizeof</span>(BITMAPFILEHEADER), <span class="hljs-number">1</span>, outptr);<br><br>    <span class="hljs-comment">// Write outfile&#x27;s BITMAPINFOHEADER</span><br>    fwrite(&amp;bi, <span class="hljs-keyword">sizeof</span>(BITMAPINFOHEADER), <span class="hljs-number">1</span>, outptr);<br><br>    <span class="hljs-comment">// Write new pixels to outfile</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height; i++)<br>    &#123;<br>        <span class="hljs-comment">// Write row to outfile</span><br>        fwrite(image[i], <span class="hljs-keyword">sizeof</span>(RGBTRIPLE), width, outptr);<br><br>        <span class="hljs-comment">// Write padding at end of row</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">0</span>; k &lt; padding; k++)<br>        &#123;<br>            fputc(<span class="hljs-number">0x00</span>, outptr);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Free memory for image</span><br>    <span class="hljs-built_in">free</span>(image);<br><br>    <span class="hljs-comment">// Close files</span><br>    fclose(inptr);<br>    fclose(outptr);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">./filter g images/yard.bmp out.bmp //这样就是错的 <br><br>./filter -g images/yard.bmp out.bmp // 这样才是对的<br></code></pre></td></tr></table></figure>

<h2 id="Makefile-作用是使用make的时候把help-c和filter-c整合到一起"><a href="#Makefile-作用是使用make的时候把help-c和filter-c整合到一起" class="headerlink" title="Makefile(作用是使用make的时候把help.c和filter.c整合到一起)"></a>Makefile(作用是使用make的时候把help.c和filter.c整合到一起)</h2><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs md">filter:<br><br><span class="hljs-code">    clang -ggdb3 -gdwarf-4 -O0 -Qunused-arguments -std=c11 -Wall -Werror -Wextra -Wno-gnu-folding-constant -Wno-sign-compare -Wno-unused-parameter -Wno-unused-variable -Wshadow -lm -o filter filter.c helpers.c</span><br></code></pre></td></tr></table></figure>

<h2 id="recover-从存储卡中恢复JPEG文件"><a href="#recover-从存储卡中恢复JPEG文件" class="headerlink" title="recover(从存储卡中恢复JPEG文件)"></a>recover(从存储卡中恢复JPEG文件)</h2><p>这种是在我们默认数码相机将照片连续存储在存储卡上才可以这样写的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">uint8_t</span> BYTE;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-comment">// 确保正确的命令行参数</span><br>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: ./recover image\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 打开取证镜像文件</span><br>    FILE *file = fopen(argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;r&quot;</span>);<br>    <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Could not open file.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    BYTE buffer[<span class="hljs-number">512</span>];<br>    FILE *img = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> filecount = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">char</span> filename[<span class="hljs-number">8</span>];<br><br>    <span class="hljs-comment">// 读取文件直到结束</span><br>    <span class="hljs-keyword">while</span> (fread(buffer, <span class="hljs-number">1</span>, <span class="hljs-number">512</span>, file) == <span class="hljs-number">512</span>)<br>    &#123;<br>        <span class="hljs-comment">// 检查是否为JPEG文件的开始</span><br>        <span class="hljs-keyword">if</span> (buffer[<span class="hljs-number">0</span>] == <span class="hljs-number">0xff</span> &amp;&amp; buffer[<span class="hljs-number">1</span>] == <span class="hljs-number">0xd8</span> &amp;&amp; buffer[<span class="hljs-number">2</span>] == <span class="hljs-number">0xff</span> &amp;&amp; (buffer[<span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xf0</span>) == <span class="hljs-number">0xe0</span>)<span class="hljs-comment">//位运算符是在二进制下处理的</span><br>        &#123;<br>            <span class="hljs-comment">// 如果已经打开了一个JPEG文件，则关闭它</span><br>            <span class="hljs-keyword">if</span> (img != <span class="hljs-literal">NULL</span>)<br>            &#123;<br>                fclose(img);<br>            &#125;<br><br>            <span class="hljs-comment">// 为新JPEG文件命名并打开它</span><br>            <span class="hljs-built_in">sprintf</span>(filename, <span class="hljs-string">&quot;%03i.jpg&quot;</span>, filecount++);<br>            img = fopen(filename, <span class="hljs-string">&quot;w&quot;</span>);<br>            <span class="hljs-keyword">if</span> (img == <span class="hljs-literal">NULL</span>)<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Could not create image.\n&quot;</span>);<br>                fclose(file);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// 如果已找到JPEG文件的开始，写入文件</span><br>        <span class="hljs-keyword">if</span> (img != <span class="hljs-literal">NULL</span>)<br>        &#123;<br>            fwrite(buffer, <span class="hljs-number">1</span>, <span class="hljs-number">512</span>, img);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 关闭最后一个JPEG文件和取证镜像文件</span><br>    <span class="hljs-keyword">if</span> (img != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        fclose(img);<br>    &#125;<br>    fclose(file);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/01/17/week%203/">week 3 上一篇 →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Violet</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/Violet-Evergardenn"><i class="fab fa-github" alt="GitHub"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Volume-%E5%B0%86wav%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9%E9%9F%B3%E9%87%8F%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.</span> <span class="toc-text">Volume(将wav文件修改音量大小)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Filter-more-%E5%AF%B9bmp%E7%9A%84%E5%9B%BE%E5%83%8F%E8%BF%9B%E8%A1%8C%E5%8F%98%E7%81%B0%EF%BC%8C%E7%BF%BB%E8%BD%AC%EF%BC%8C%E6%A8%A1%E7%B3%8A%EF%BC%8C%E8%BE%B9%E7%BC%98%E5%A4%84%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">Filter more(对bmp的图像进行变灰，翻转，模糊，边缘处理)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bmp-h-%E5%8C%85%E5%90%AB%E5%A4%84%E7%90%86bmp%E5%9B%BE%E5%83%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">bmp.h(包含处理bmp图像的数据结构)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#help-h-%E5%BD%A2%E6%88%90%E5%A4%B4%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B9%B6%E6%8A%8Abmp-h%E4%B9%9F%E5%B8%A6%E8%BF%9Bhelp-c%E4%B8%AD"><span class="toc-number">2.2.</span> <span class="toc-text">help.h(形成头文件，并把bmp.h也带进help.c中)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#help-c-%E5%AE%9E%E7%8E%B0%E5%8F%98%E7%81%B0%EF%BC%8C%E7%BF%BB%E8%BD%AC%EF%BC%8C%E6%A8%A1%E7%B3%8A%EF%BC%8C%E8%BE%B9%E7%BC%98%E5%8A%9F%E8%83%BD"><span class="toc-number">2.3.</span> <span class="toc-text">help.c(实现变灰，翻转，模糊，边缘功能)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filter-c-%E9%9B%86%E5%90%88%E6%89%80%E6%9C%89%EF%BC%8C%E5%AE%9E%E7%8E%B0%E7%9B%AE%E6%A0%87"><span class="toc-number">2.4.</span> <span class="toc-text">filter.c(集合所有，实现目标)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Makefile-%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BD%BF%E7%94%A8make%E7%9A%84%E6%97%B6%E5%80%99%E6%8A%8Ahelp-c%E5%92%8Cfilter-c%E6%95%B4%E5%90%88%E5%88%B0%E4%B8%80%E8%B5%B7"><span class="toc-number">2.5.</span> <span class="toc-text">Makefile(作用是使用make的时候把help.c和filter.c整合到一起)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#recover-%E4%BB%8E%E5%AD%98%E5%82%A8%E5%8D%A1%E4%B8%AD%E6%81%A2%E5%A4%8DJPEG%E6%96%87%E4%BB%B6"><span class="toc-number">2.6.</span> <span class="toc-text">recover(从存储卡中恢复JPEG文件)</span></a></li></ol></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> 主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>